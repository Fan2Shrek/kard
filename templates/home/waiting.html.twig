{% extends 'base.html.twig' %}

{% block title %}Hello!{% endblock %}

{% block body %}
    <main class="flex flex-col h-screen justify-between items-center text-3xl font-bold">
        <h1>En attente de joueurs !</h1>
        <div {{ stimulus_controller('stream', { url: mercure('waiting') }) }}></div>
        <div id="player-join" class="flex flex-col items-center gap-4">
            <h2>Joueurs</h2>
            {% for player in players %}
                {% include "components/turbo/player-join.html.twig" with {"player": player} %}
            {% endfor %}
        </div>

        {% if room.owner == app.user %}
            {% include "components/ux/button.html.twig" with { 'href': path('game_start', {'id': room.id}), 'text': 'Commencer !' } %}
        {% endif %}
        <div {{ stimulus_controller('waiting') }}></div>
    </main>
{% endblock %}
{% block endscript %}
    <script type="application/json" id="mercure-url">
        {{ mercure('game-'~room.id, { subscribe: 'game-'~room.id })|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw }}
    </script>
{% endblock %}
